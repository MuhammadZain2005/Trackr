<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trackr</title>
  <link rel="stylesheet" href="/src/styles.css" />
</head>

<body>
  <div id="app" v-cloak>
    <div class="page">
      <!-- Hero Section -->
      <div class="hero">
        <div class="topbar">
          <div class="brand">
            <div class="logo">
              <!-- Replace the small dot with a project logo. Put your PNG at /frontend/public/logo.png -->
              <img src="/logo.png" alt="Trackr logo" class="logo-img" />
            </div>
            <div class="brand-name">Trackr</div>
          </div>

          <nav class="nav">
            <a href="index.html" class="nav-link is-active">Dashboard</a>
            <a href="resumes.html" class="nav-link">Resumes</a>
            <a href="profile.html" class="nav-link">Profile</a>
          </nav>

          <div class="topbar-actions">
            <button class="icon-button" @click="loadSampleData" title="Load Sample Data">
              <svg fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
              </svg>
            </button>
            <a href="profile.html" class="avatar avatar-image" title="Profile & settings">
              <img src="/image.png" alt="Profile" />
            </a>
          </div>
        </div>

        <div class="hero-grid">
          <div class="hero-copy">
            <p class="kicker">Organized & Efficient</p>
            <h1>Track Your Job Search</h1>
            <p class="subtitle">
              Manage applications, follow-ups, and communications in one place. Never miss an opportunity.
            </p>
            <p class="note">{{ activeCount }} active applications ‚Ä¢ {{ applications.length }} total</p>
          </div>
        </div>

        <div class="hero-search">
          <div class="search-pill">
            <div class="search-field">
              <div class="search-icon">
                <svg fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                  />
                </svg>
              </div>

              <input v-model="searchTerm" type="search" placeholder="Search by company or position" />

              <div class="divider"></div>

              <select v-model="statusFilter">
                <option value="All">All Statuses</option>
                <!-- Removed Saved everywhere -->
                <option
                  v-for="status in statuses.filter(s => s !== 'Saved')"
                  :key="status"
                  :value="status"
                >
                  {{ status }}
                </option>
              </select>
            </div>

            <button class="primary-pill" @click="openTrackModal">Track Application</button>
          </div>
        </div>

        <div v-if="storageError" class="error">{{ storageError }}</div>
      </div>

      <!-- Stats -->
      <div class="stats">
        <div class="stat-card primary">
          <p class="stat-label">Active Applications</p>
          <div class="stat-value">{{ activeCount }}</div>
        </div>
        <div class="stat-card">
          <p class="stat-label">Total Applications</p>
          <div class="stat-value">{{ applications.length }}</div>
        </div>
        <div class="stat-card">
          <p class="stat-label">Interviews</p>
          <div class="stat-value">{{ stats['Interview'] }}</div>
        </div>
        <div class="stat-card">
          <p class="stat-label">Offers</p>
          <div class="stat-value">{{ stats['Offer'] }}</div>
        </div>
      </div>

      <!-- Applications Board -->
      <div class="layout">
        <div class="panel span-2 kanban-panel">
          <div class="kanban-header">
            <div class="kanban-header-left">
              <h2>Applications</h2>
              <p class="kanban-subtext">{{ activeCount }} active ¬∑ {{ nextFollowUpText }}</p>
            </div>
            <div class="kanban-header-right">
              <div class="kanban-search">
                <svg class="kanban-search-icon" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <input v-model="searchTerm" type="search" placeholder="Search company or role..." />
              </div>
              <select v-model="sortBy" class="kanban-sort">
                <option value="updated">Recently Updated</option>
                <option value="dateApplied">Date Applied</option>
                <option value="followUp">Follow-up Date</option>
              </select>
            </div>
          </div>

          <div v-if="sortedApplications.length === 0" class="empty-state">
            No applications yet. Add one to get started!
          </div>

          <div v-else class="kanban-board">
            <div
              v-for="status in statuses.filter(s => s !== 'Saved')"
              :key="status"
              class="kanban-column"
              @dragover.prevent
              @dragenter.prevent="dragEnterColumn($event)"
              @dragleave="dragLeaveColumn($event)"
              @drop="dropCard($event, status)"
            >
              <div class="kanban-column-header">
                <h4>{{ status }}</h4>
                <span class="kanban-column-count">{{ bucketed[status].length }}</span>
              </div>

              <div class="kanban-column-cards">
                <div
                  v-for="app in bucketed[status]"
                  :key="app.id"
                  class="kanban-card"
                  draggable="true"
                  @dragstart="dragStart($event, app)"
                  @dragend="dragEnd($event)"
                >
                  <!-- Card Header -->
                  <div class="kanban-card-header">
                    <div class="kanban-card-title">
                      <h4>{{ app.company }}</h4>
                      <p>{{ app.position }}</p>
                    </div>
                    <div class="kanban-card-actions">
                      <span class="priority-dot" :class="'priority-dot-' + app.priority.toLowerCase()" :title="app.priority + ' priority'"></span>
                      <div class="kebab-menu">
                        <button class="kebab-trigger" @click.stop="toggleMenu(app.id)" title="More actions">
                          <svg viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="5" r="2"/>
                            <circle cx="12" cy="12" r="2"/>
                            <circle cx="12" cy="19" r="2"/>
                          </svg>
                        </button>
                        <div v-if="openMenuId === app.id" class="kebab-dropdown" @click.stop>
                          <button v-if="!app.tailoredResume" @click="useMaster(app); closeMenu()">
                            <span>üìÑ</span> Use Master Resume
                          </button>
                          <button @click="toggleArchive(app); closeMenu()">
                            <span>üì¶</span> {{ app.archived ? 'Restore' : 'Archive' }}
                          </button>
                          <button class="kebab-danger" @click="removeApplication(app.id); closeMenu()">
                            <span>üóëÔ∏è</span> Delete
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Meta Row -->
                  <div class="kanban-card-meta">
                    {{ app.location || 'Remote' }} ¬∑ Applied {{ formatDateShort(app.dateApplied) }}
                  </div>

                  <!-- Follow-up Indicator -->
                  <div v-if="app.followUpDate" class="kanban-card-followup" :class="'followup-' + dueClass(app.followUpDate)">
                    <span class="followup-icon">{{ followUpIcon(app.followUpDate) }}</span>
                    <span class="followup-label">{{ followUpLabel(app.followUpDate) }}</span>
                    <span class="followup-date">{{ formatDateShort(app.followUpDate) }}</span>
                  </div>

                  <!-- Quick Info Icons -->
                  <div class="kanban-card-icons" v-if="app.notes || app.communications.length || app.tailoredResume">
                    <span v-if="app.notes" title="Has notes">üìù</span>
                    <span v-if="app.communications.length" title="Has communications">üí¨</span>
                    <span v-if="app.tailoredResume" title="Has tailored resume">üìÑ</span>
                  </div>

                  <!-- Primary Action -->
                  <button class="kanban-card-cta" @click="openCommModal(app)">
                    ‚ûï Add Communication
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reminders -->
      <div class="layout reminders-layout">
        <div id="reminders" class="panel span-2 reminders-panel">
          <h2>Upcoming Follow-ups</h2>

          <div v-if="reminders.length === 0" class="empty-state">
            No follow-ups scheduled
          </div>

          <div v-else class="reminders">
            <div v-for="app in reminders" :key="app.id" class="reminder-card">
              <div>
                <h4 class="reminder-title">{{ app.company }} - {{ app.position }}</h4>
                <p class="muted">{{ app.location }}</p>
              </div>
              <span class="pill" :class="dueClass(app.followUpDate)">
                {{ dueLabel(app.followUpDate) }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="footer">
        <button class="ghost" @click="loadSampleData">Load Sample Data</button>
        <button class="danger" @click="clearAll">Clear All</button>
      </div>

      <!-- Communication Modal -->
      <div v-if="showCommModal" class="modal-overlay" @click.self="closeCommModal">
        <div class="modal comm-modal" role="dialog" aria-modal="true">
          <div class="modal-header">
            <div>
              <h2>Add Communication</h2>
              <p class="modal-subtitle">{{ commModalApp?.company }} - {{ commModalApp?.position }}</p>
            </div>
            <button class="icon-button ghost" type="button" @click="closeCommModal" aria-label="Close">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 6 6 18"/>
                <path d="m6 6 12 12"/>
              </svg>
            </button>
          </div>

          <form class="comm-form" @submit.prevent="submitCommModal">
            <div class="comm-form-row">
              <label>
                Date
                <input v-model="commModalDraft.date" type="date" required />
              </label>
              <label>
                Type
                <select v-model="commModalDraft.type">
                  <option>Email</option>
                  <option>Phone</option>
                  <option>Interview</option>
                  <option>Offer</option>
                  <option>Other</option>
                </select>
              </label>
            </div>
            <label>
              Summary
              <textarea v-model="commModalDraft.summary" placeholder="What happened?" rows="4" required></textarea>
            </label>
            <div class="comm-form-actions">
              <button type="button" class="ghost" @click="closeCommModal">Cancel</button>
              <button type="submit">Add Communication</button>
            </div>
          </form>

          <!-- Previous Communications -->
          <div v-if="commModalApp?.communications.length" class="comm-history">
            <h3>Previous Communications</h3>
            <div v-for="comm in commModalApp.communications" :key="comm.id" class="comm-history-item">
              <div class="comm-history-header">
                <span class="comm-history-type">{{ comm.type }}</span>
                <span class="comm-history-date">{{ formatDateShort(comm.date) }}</span>
              </div>
              <p>{{ comm.summary }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for Track Application -->
    <div v-if="showTrackModal" class="modal-overlay" @click.self="closeTrackModal">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="track-title">
        <div class="modal-header">
          <h2 id="track-title">Track an Application</h2>
          <button class="icon-button ghost" type="button" @click="closeTrackModal" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M18 6 6 18" />
              <path d="m6 6 12 12" />
            </svg>
          </button>
        </div>

        <form class="form-grid" @submit.prevent="addApplication" style="margin-top: 20px;">
          <label>
            Company
            <input v-model="form.company" placeholder="Company name" required />
          </label>

          <label>
            Position
            <input v-model="form.position" placeholder="Job title" required />
          </label>

          <label>
            Location
            <input v-model="form.location" placeholder="City, Country" />
          </label>

          <label>
            Source
            <input v-model="form.source" placeholder="Referral, LinkedIn, etc." />
          </label>

          <label>
            Date Applied
            <input v-model="form.dateApplied" type="date" />
          </label>

          <label>
            Follow-up Date
            <input v-model="form.followUpDate" type="date" />
          </label>

          <label>
            Status
            <!-- Removed Saved here too -->
            <select v-model="form.status">
              <option
                v-for="status in statuses.filter(s => s !== 'Saved')"
                :key="status"
                :value="status"
              >
                {{ status }}
              </option>
            </select>
          </label>

          <label>
            Priority
            <select v-model="form.priority">
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
          </label>

          <label style="grid-column: span 2;">
            Notes
            <textarea v-model="form.notes" placeholder="Add any notes..." rows="3"></textarea>
          </label>

          <label class="checkbox" style="grid-column: span 2;">
            <input v-model="form.useMasterResume" type="checkbox" />
            Start tailored resume from the master version
          </label>

          <div style="grid-column: span 2; display: flex; gap: 10px;">
            <button type="submit">Add Application</button>
            <button class="ghost" type="button" @click="resetForm">Reset</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.jsx"></script>
</body>
</html>
