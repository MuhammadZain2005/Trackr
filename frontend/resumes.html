<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resumes · Trackr</title>
  <link rel="stylesheet" href="/src/styles.css" />
</head>

<body>
  <div class="page resumes-page">
    <!-- Hero Section (matches Dashboard) -->
    <div class="hero resumes-hero">
      <div class="topbar">
        <div class="brand">
          <div class="logo">
            <img src="/logo.png" alt="Trackr logo" class="logo-img" />
          </div>
          <div class="brand-name">Trackr</div>
        </div>

        <nav class="nav">
          <a href="/index.html" class="nav-link">Dashboard</a>
          <a href="/resumes.html" class="nav-link is-active">Resumes</a>
          <a href="/profile.html" class="nav-link">Profile</a>
        </nav>

        <div class="topbar-actions">
          <span id="authBadge" class="auth-badge-hero">Checking…</span>
          <a href="/profile.html" class="avatar" title="Profile">
            <span>PC</span>
          </a>
        </div>
      </div>

      <div class="hero-grid">
        <div class="hero-copy">
          <p class="kicker">Resume Management</p>
          <h1>Your Resumes</h1>
          <p class="subtitle">
            Edit your master resume and create tailored versions for specific roles and companies.
          </p>
          <p class="note" id="resumeStats">Master + 0 variants</p>
        </div>
      </div>

      <!-- Track Selector (inside hero, styled like search-pill) -->
      <div class="hero-search">
        <div class="search-pill">
          <div class="search-field">
            <div class="search-icon">
              <svg fill="currentColor" viewBox="0 0 24 24">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zM8 17v-1h8v1H8zm0-3v-1h8v1H8zm0-3v-1h5v1H5z"/>
              </svg>
            </div>

            <select id="trackSelector" class="track-select">
              <option value="master">Master Resume</option>
            </select>

            <div class="divider"></div>

            <div id="buildStatusPill" class="build-pill build-pill-idle">
              <span class="build-dot"></span>
              <span class="build-text">Ready</span>
            </div>
          </div>

          <button id="btnNewVariant" class="primary-pill" type="button">+ New Variant</button>
        </div>
      </div>
    </div>

    <!-- Main Workspace Card -->
    <div class="panel workspace-panel">
      <!-- Action Bar -->
      <div class="workspace-actionbar">
        <div class="workspace-actionbar-left">
          <h2 id="currentTrackTitle">Master Resume</h2>
          <span id="breadcrumb" class="breadcrumb-pill">Master</span>
        </div>
        <div class="workspace-actionbar-right">
          <button id="btnSaveDraft" class="ghost" type="button" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
              <polyline points="17,21 17,13 7,13 7,21"/>
              <polyline points="7,3 7,8 15,8"/>
            </svg>
            Save
          </button>
          <button id="btnBuildPdf" type="button" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5,3 19,12 5,21"/>
            </svg>
            Build PDF
          </button>
        </div>
      </div>

      <!-- Split Workspace -->
      <div class="workspace-split">
        <!-- Editor Pane -->
        <div class="workspace-editor">
          <div class="pane-header">
            <span class="pane-label">LaTeX Source</span>
            <div class="pane-actions">
              <button id="btnCopyLatex" class="btn-small ghost" type="button" title="Copy to clipboard">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                </svg>
                Copy
              </button>
            </div>
          </div>
          <div id="editorContainer" class="editor-wrapper"></div>
        </div>

        <!-- Divider -->
        <div class="workspace-divider"></div>

        <!-- Preview Pane -->
        <div class="workspace-preview">
          <div class="pane-header">
            <span class="pane-label">PDF Preview</span>
            <div class="pane-meta">
              <span id="lastBuiltTime" class="pane-timestamp">Not built yet</span>
            </div>
            <div class="pane-actions">
              <button id="btnDownloadPdf" class="btn-small ghost" type="button" title="Download PDF" disabled>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                  <polyline points="7,10 12,15 17,10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Download
              </button>
            </div>
          </div>
          <div class="preview-wrapper">
            <div id="previewContent" class="preview-paper">
              <div class="preview-empty-state">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                  <polyline points="14,2 14,8 20,8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10,9 9,9 8,9"/>
                </svg>
                <p>Click <strong>Build PDF</strong> to generate preview</p>
                <p class="muted">Or press Cmd/Ctrl + B</p>
              </div>
            </div>
            <!-- Error Panel (hidden by default) -->
            <div id="errorPanel" class="error-card" style="display: none;">
              <div class="error-card-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>Build Failed</span>
              </div>
              <p id="errorMessage" class="error-text"></p>
              <details class="error-details-block">
                <summary>Build Log</summary>
                <pre id="errorLog"></pre>
              </details>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Version History Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-header-left">
          <h2>Version History</h2>
          <span id="historyCount" class="history-badge">0 snapshots</span>
        </div>
        <div class="panel-actions">
          <button id="btnCreateSnapshot" class="ghost" type="button" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Create Snapshot
          </button>
        </div>
      </div>

      <div id="historyEmpty" class="empty-state" style="margin-top: 16px;">
        No snapshots yet. Create one to save your progress.
      </div>

      <div id="historyList" class="history-list" style="display: none;"></div>
    </div>
  </div>

  <!-- Create Snapshot Modal -->
  <div id="snapshotModal" class="modal-overlay" style="display: none;">
    <div class="modal snapshot-modal">
      <div class="modal-header">
        <h2>Create Snapshot</h2>
        <button class="icon-button ghost" type="button" id="closeSnapshotModal" aria-label="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
          </svg>
        </button>
      </div>
      <form id="snapshotForm" class="form-grid" style="margin-top: 20px;">
        <label style="grid-column: span 2;">
          Label
          <input id="snapshotLabel" type="text" placeholder="e.g., v2, ML variant, Final draft" required />
        </label>
        <label style="grid-column: span 2;">
          Link to Application (optional)
          <select id="snapshotAppLink">
            <option value="">None</option>
          </select>
        </label>
        <div style="grid-column: span 2; display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px;">
          <button type="button" class="ghost" id="cancelSnapshot">Cancel</button>
          <button type="submit">Create Snapshot</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Variant Modal -->
  <div id="variantModal" class="modal-overlay" style="display: none;">
    <div class="modal variant-modal">
      <div class="modal-header">
        <h2>New Variant</h2>
        <button class="icon-button ghost" type="button" id="closeVariantModal" aria-label="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
          </svg>
        </button>
      </div>
      <form id="variantForm" class="form-grid" style="margin-top: 20px;">
        <label>
          Variant Type
          <select id="variantType" required>
            <option value="Role">Role Variant (ML, SWE, DS, etc.)</option>
            <option value="Company">Company-Specific Resume</option>
          </select>
        </label>
        <label>
          Title
          <input id="variantTitle" type="text" placeholder="e.g., ML Engineer, Google SWE" required />
        </label>
        <label id="variantAppLabel" style="display: none;">
          Link to Application
          <select id="variantAppLink">
            <option value="">Select application…</option>
          </select>
        </label>
        <label>
          Base Content From
          <select id="variantBase" required>
            <option value="master">Master Resume</option>
          </select>
        </label>
        <div style="grid-column: span 2; display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px;">
          <button type="button" class="ghost" id="cancelVariant">Cancel</button>
          <button type="submit">Create Variant</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module" src="/src/services/resumes.js"></script>
</body>
</html>
